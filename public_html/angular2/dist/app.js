var app=angular.module("app",["ngRoute"]);app.config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"angular2/src/templates/index.html"}).when("/edit/:id",{title:"Editar",templateUrl:"angular2/src/templates/edit.html",controller:"editController"}).otherwise({redirectTo:"/"})}]),app.filter("startFrom",function(){return function(e,t){return t=+t,e.slice(t)}}),app.directive("jqdatepicker",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,o){$(t).datepicker({dateFormat:"dd/mm/yy",beforeShow:function(){$(".ui-datepicker").css("font-size",12)},onSelect:function(t){e.$apply(function(){o.$setViewValue(t)})}})}}}),app.directive("jqdatepickerweek",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,o){var r;$(t).datepicker({showOtherMonths:!0,selectOtherMonths:!0,dateFormat:"dd/mm/yy",beforeShow:function(){$(".ui-datepicker").css("font-size",12)},onSelect:function(t,a){var n=$(this).datepicker("getDate"),i=0!=n.getDay()?7:0;r=new Date(n.getFullYear(),n.getMonth(),n.getDate()-n.getDay()+i);var c=a.settings.dateFormat||$.datepicker._defaults.dateFormat,s=$.datepicker.formatDate(c,r,a.settings);$(this).datepicker("setDate",s),e.$apply(function(){o.$setViewValue(s)})}})}}}),app.directive("showTab",function(){return{link:function(e,t,a){t.on("click",function(e){e.preventDefault(),$(t).tab("show")})}}}),app.directive("toggle",function(){return{restrict:"A",link:function(e,t,a){"tooltip"==a.toggle&&$(t).tooltip(),"popover"==a.toggle&&$(t).popover()}}}),app.directive("capitalize",function(){return{require:"ngModel",link:function(e,t,a,o){var r=function(e){void 0==e&&(e="");var t=e.toUpperCase();return t!==e&&(o.$setViewValue(t),o.$render()),t};o.$parsers.push(r),r(e[a.ngModel])}}}),app.directive("loading",["$http",function(e){return{restrict:"A",link:function(t,a,o){t.isLoading=function(){return e.pendingRequests.length>0},t.$watch(t.isLoading,function(e){e?a.show():a.hide()})}}}]),app.directive("modalShow",["$parse",function(e){return{restrict:"A",link:function(t,a,o){t.showModal=function(e,t){t||(t=a),e?$(t).modal("show"):$(t).modal("hide")},t.$watch(o.modalShow,function(e,a){t.showModal(e,o.$$element)}),$(a).bind("hide.bs.modal",function(){e(o.modalShow).assign(t,!1),t.$$phase||t.$root.$$phase||t.$apply()})}}}]),app.directive("ngConfirmClick",function(){return{link:function(e,t,a){var o=a.ngConfirmClick||"¿Confirmar acción?",r=a.confirmedClick;t.bind("click",function(t){window.confirm(o)&&e.$apply(r)})}}}),app.directive("stringToNumber",function(){return{require:"ngModel",link:function(e,t,a,o){o.$parsers.push(function(e){return""+e}),o.$formatters.push(function(e){return parseFloat(e,2)})}}}),app.controller("appController",["$scope","$http",function(e,t){function a(e,t,a){return e.selected===!0}e.trabajos=[],e.orderByField="km_inicio",e.reverseSort=!1,e.currentPage=0,e.pageSize=20,t.get("programar").success(function(t){e.trabajos=t,console.info("trabajos",t.length)}),t.get("grupos").success(function(t){e.grupos=t,console.info("grupos",t.length)}),t.get("trabajo").success(function(t){e.partidas=t,console.info("partidas",t.length)}),e.createTrabajo=function(a){t.post("programar",a).success(function(t){t.error?e.errors=t.msg:(e.trabajos.push(t.trabajo),e.errors=[],a.causa="",a.trabajo_id="",a.km_inicio="",a.km_termino="",a.cantidad="")})},e.deleteTrabajo=function(a){confirm("¿Eliminar "+a.nombre+"?")&&t["delete"]("programar/"+a.id).success(function(t){if(!t.error){var o=e.trabajos.indexOf(a);e.trabajos.splice(o,1)}})},e.updateTrabajo=function(e){t.put("programar/"+e.id,e).success(function(t){t.error||(e.status=t.status,e.no_programable&&(e.semana=""))})},e.filtrar=function(a){t.get("programar",{params:a}).success(function(t){e.trabajos=t})},e.selectAll=function(){var t=!e.isAllSelected;angular.forEach(e.trabajos,function(e){e.selected=t}),e.isAllSelected=t},e.toggleSelection=function(){e.isAllSelected=e.trabajos.every(a)},e.deleteSelected=function(){var a=[];angular.forEach(e.trabajos,function(e){e.selected&&a.push(e)}),a.forEach(function(a){t["delete"]("programar/"+a.id).success(function(t){if(!t.error){var o=e.trabajos.indexOf(a);e.trabajos.splice(o,1)}})})},e.updateSelected=function(a){var o=[];angular.forEach(e.trabajos,function(e){e.selected&&o.push(e)});var r={};a.causa&&(r.causa=a.causa),a.grupo_trabajo_id&&(r.grupo_trabajo_id=a.grupo_trabajo_id),a.semana&&(r.semana=a.semana),a.vencimiento&&(r.vencimiento=a.vencimiento),a.lun&&(r.lun=a.lun),a.mar&&(r.mar=a.mar),a.mie&&(r.mie=a.mie),a.juv&&(r.juv=a.juv),a.vie&&(r.vie=a.vie),a.sab&&(r.sab=a.sab),a.dom&&(r.dom=a.dom);var n={modal:r,trabajos:o};t.post("programar/selected",n).success(function(t){if(!t.error){var a=t.status;angular.forEach(e.trabajos,function(e){e.selected&&(e.selected=!1,a.forEach(function(t){e.id==t.id&&(e.status=t["class"])}),n.modal.causa&&(e.causa=n.modal.causa),n.modal.grupo_trabajo_id&&(e.grupo_trabajo_id=n.modal.grupo_trabajo_id),n.modal.semana&&(e.semana=n.modal.semana),n.modal.vencimiento&&(e.vencimiento=n.modal.vencimiento),n.modal.lun&&(e.lun=n.modal.lun),n.modal.mar&&(e.mar=n.modal.mar),n.modal.mie&&(e.mie=n.modal.mie),n.modal.juv&&(e.juv=n.modal.juv),n.modal.vie&&(e.vie=n.modal.vie),n.modal.sab&&(e.sab=n.modal.sab),n.modal.dom&&(e.dom=n.modal.dom))})}}),a.causa=null,a.grupo_trabajo_id=null,a.semana=null,a.vencimiento=null,a.lun=null,a.mar=null,a.mie=null,a.juv=null,a.vie=null,a.sab=null,a.dom=null},e.archiveSelected=function(){var a=[];angular.forEach(e.trabajos,function(e){e.selected&&a.push(e)}),a.forEach(function(e){e.realizado=!0,e.status="success",t.put("programar/"+e.id,e).success(function(t){t.error||(e.status=t.status)})})},e.numberOfPages=function(){return Math.floor(e.trabajos.length/e.pageSize)}}]),app.controller("editController",["$scope","$http","$routeParams","$location",function(e,t,a,o){e.textButton="Editar programa trabajo";var r,n,i=e.trabajos.length;for(r=0;i>r&&(n=e.trabajos[r],n.id!=a.id);r++);e.trabajo=n,e.editTrabajo=function(){o.url("/"),t.put("programar/"+e.trabajo.id,e.trabajo).success(function(t){t.error||(e.trabajos[r]=e.trabajo)})}}]);